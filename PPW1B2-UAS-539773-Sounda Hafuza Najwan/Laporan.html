<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Laporan</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Esteban&family=Noto+Sans:wght@400;800&display=swap"
    rel="stylesheet" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

  <!-- DataTables Bootstrap 5 CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.0/css/dataTables.bootstrap5.min.css" />

  <style>
    .nav_website {
      background-color: black;
      padding: 2%;
      margin-bottom: 5vh;
    }

    .nav_website a {
      font-family: 'Inter';
      font-weight: 600;
      font-size: 18px;
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
    }

    .nav_website a:hover {
      background-color: white;
      color: black;
      transition: 0.3s;
    }

    .Judul {
      padding: 4%;
      font-family: 'Inter';
      font-weight: 600;
      font-size: 20px;
    }

    .kartu {
      margin: 5% 0 0 5%;
      background-color: #F5F5F5;
      height: 20vh;
      border-radius: 10px;
    }

    .headerkartu {
      text-align: left;
      padding: 5% 0 0 5%;
      font-size: 14px;
      font-weight: 600;
    }

    .row {
      margin-bottom: 20px;
    }

    .isi {
      padding-top: 15%;
    }

    .filter_bar {
      position: relative;
    }

    .sort1 {
      padding-left: 4%;
      opacity: 1;
    }

    .sort2 {
      padding-left: 4%;
      opacity: 1;
    }

    .sort3 {
      padding-left: 4%;
      opacity: 0;
    }

    .tombol_modif {
      position: absolute;
      right: 4%;
      top: 0;
      display: flex;
      gap: 10px;
      align-items: center;
      opacity: 0;
    }

    .tombol1 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #db1515;
      cursor: alias;
    }

    .tombol2 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #000000;
      cursor: alias;
    }

    .tombol3 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #db1515;
      cursor: alias;
    }

    .tombol4 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #000000;
      cursor: alias;
    }

    .tabel1 {
      padding: 0 4%;
      margin-bottom: 20vh;
    }

    .tabel2 {
      padding: 0 4%;
      margin-bottom: 20vh;
    }

    .tabel3 {
      padding: 0 4%;
      margin-bottom: 20vh;
    }

    .table th {
      text-align: center;
    }

    .kolom th {
      background-color: #D9D9D9;
      border-right: 1px solid black;
      text-align: center;
    }

    tbody {
      text-align: center;
    }

    .kolom_total h5 {
      text-align: center;
    }

    table.dataTable thead th {
      background-color: #D9D9D9 !important;
      color: black;
      vertical-align: middle;
    }

    table.dataTable thead th.sorting::after,
    table.dataTable thead th.sorting_asc::after,
    table.dataTable thead th.sorting_desc::after {
      color: black !important;
      opacity: 1 !important;
    }

    table.dataTable thead th.sorting::after {
      content: "\f0dc";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    table.dataTable thead th.sorting_asc::after {
      content: "\f0de";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    table.dataTable thead th.sorting_desc::after {
      content: "\f0dd";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }
  </style>
</head>

<body>

  <!-- Modifikasi Produk -->

  <!-- Navigation -->
  <nav class="nav_website">
    <ul class="nav nav-pills nav-fill">
      <li class="nav-item"><a class="nav-link" href="proteksiDashboard.php">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="proteksiMP.php">Manajemen Produk</a></li>
      <li class="nav-item"><a class="nav-link" href="proteksiMT.php">Manajemen Transaksi</a></li>
      <li class="nav-item"><a class="nav-link" href="proteksiLaporan.php">Laporan</a></li>
      <li class="nav-item"><a class="nav-link" href="#" id="logoutBtn">Log Out</a></li>
    </ul>
  </nav>

  <!-- Judul -->
  <section class="Judul">
    <p>Ringkasan <br> (Summary)</p>
  </section>

  <!--Summary -->
  <div class="container text-center">
    <div class="row">
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Penjualan</div>
          <div class="bodykartu">
            <h5 id="totalSales" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Pembelian</div>
          <div class="bodykartu">
            <h5 id="totalBuy" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Laba Kotor</div>
          <div class="bodykartu">
            <h5 id="grossProfit" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Laba Bersih</div>
          <div class="bodykartu">
            <h5 id="netProfit" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Stok</div>
          <div class="bodykartu">
            <h5 id="totalStok" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Penjualan Bulanan</div>
          <div class="bodykartu">
            <h5 id="totalSales2" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Pembelian Bulanan</div>
          <div class="bodykartu">
            <h5 id="totalBuy2" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Laba Kotor Bulanan</div>
          <div class="bodykartu">
            <h5 id="grossProfit2" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Laba Bersih Bulanan</div>
          <div class="bodykartu">
            <h5 id="netProfit2" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Jenis Produk</div>
          <div class="bodykartu">
            <h5 id="totalStok2" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <article style="padding: 4% 0 4% 4%;">
    <p>Keterangan:<br>
      1. COGS + Miscellaneous Expenditures untuk keseluruhan/tahunannya adalah Rp3.600.000<br>
      2. COGS + Miscellaneous Expenditures bulanannya adalah Rp300.000
    </p>
  </article>


  <!-- Laporan Penjualan Bulanan -->

  <!-- Judul -->
  <section class="Judul">
    <p>Laporan Penjualan Bulanan <br> (Monthly Sales Report)</p>
  </section>

  <!-- Filter Bar -->
  <section class="filter_bar">
    <div class="d-flex justify-content-between align-items-start mb-3">

      <div class="sort1">
        <select class="form-select" id="bulanFilterPenjualan" style="width: auto;">
          <option value="">Pilih Bulan</option>
          <option value="">All</option>
          <option value="1">Januari</option>
          <option value="2">Februari</option>
          <option value="3">Maret</option>
          <option value="4">April</option>
          <option value="5">Mei</option>
          <option value="6">Juni</option>
          <option value="7">Juli</option>
          <option value="8">Agustus</option>
          <option value="9">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
      </div>

      <div class="tombol_modif">
        <button class="tombol1 btn btn-dark" disabled><span>Delete All</span><i class="fa-solid fa-trash"></i></button>
        <button class="tombol2 btn btn-dark" disabled><span>Add Data</span><i
            class="fa-solid fa-square-plus"></i></button>
      </div>
    </div>
  </section>

  <!-- Tabel Laporan Penjualan -->
  <section class="tabel1">
    <table class="table table-bordered align-middle" id="datatableid1">
      <thead>
        <tr class="kolom">
          <th style="border-top-left-radius: 10px; border-bottom-left-radius: 10px; width: 20%">Tanggal</th>
          <th style="width: 20%">ID Penjualan/Nota</th>
          <th style="width: 20%">Total Transaksi</th>
          <th style="width: 20%">Total Produk Terjual</th>
          <th style="border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-right: none; width: 20%">
            Detail</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr class="kolom_total">
          <td colspan="2">
            <h5>Total</h5>
          </td>
          <td>
            <h5>0</h5>
          </td>
          <td>
            <h5 style="text-align: right;">0</h5>
          </td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </section>

  <!-- Modal Detail Penjualan -->
  <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detail Transaksi Penjualan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <p><strong>Tanggal:</strong> <span id="detailTanggal"></span></p>
          <p><strong>ID Penjualan/Nota:</strong> <span id="detailID"></span></p>
          <p><strong>Total:</strong> <span id="detailTotal"></span></p>

          <h6>Daftar Produk:</h6>
          <table class="table" id="detailDetail">
            <thead>
              <tr>
                <th>ID Detail Penjualan</th>
                <th>Jumlah</th>
                <th>Nama Produk</th>
                <th>Harga Jual</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>



  <!-- Laporan Pembelian Bulanan -->

  <!-- Judul -->
  <section class="Judul">
    <p>Laporan Pembelian Bulanan <br> (Monthly Purchasing Report)</p>
  </section>

  <!-- Filter Bar -->
  <section class="filter_bar">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="sort2">
        <select class="form-select" id="bulanFilterPembelian" style="width: auto;">
          <option value="">Pilih Bulan</option>
          <option value="">All</option>
          <option value="1">Januari</option>
          <option value="2">Februari</option>
          <option value="3">Maret</option>
          <option value="4">April</option>
          <option value="5">Mei</option>
          <option value="6">Juni</option>
          <option value="7">Juli</option>
          <option value="8">Agustus</option>
          <option value="9">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
      </div>

      <div class="tombol_modif">
        <button class="tombol3 btn btn-dark" disabled><span>Delete All</span><i class="fa-solid fa-trash"></i></button>
        <button class="tombol4 btn btn-dark" disabled><span>Add Data</span><i
            class="fa-solid fa-square-plus"></i></button>
      </div>
    </div>
  </section>

  <!-- Tabel Pembelian -->
  <section class="tabel2">
    <table class="table table-bordered align-middle" id="datatableid2">
      <thead>
        <tr class="kolom">
          <th style="border-top-left-radius: 10px; border-bottom-left-radius: 10px; width: 20%">Tanggal</th>
          <th style="width: 20%">ID Pembelian/Nota</th>
          <th style="width: 20%">Total Transaksi</th>
          <th style="width: 20%">Total Produk Dibeli</th>
          <th style="border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-right: none; width: 20%">
            Detail</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr class="kolom_total2">
          <td colspan="2" style="text-align: center;">
            <h5>Total</h5>
          </td>
          <td style="text-align: center;">
            <h5>0</h5>
          </td>
          <td>
            <h5 style="text-align: right;">0</h5>
          </td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </section>

  <!-- Modal Detail Pembelian -->
  <div class="modal fade" id="detailModal2" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detail Transaksi Pembelian</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <p><strong>Tanggal: </strong> <span id="detailTanggal2"></span></p>
          <p><strong>Total: </strong> <span id="detailTotal2"></span></p>

          <h6>Daftar Produk:</h6>
          <table class="table" id="detailDetail2">
            <thead>
              <tr>
                <th style="width: 10%;">ID Pembelian/Nota</th>
                <th style="width: 10%;">ID Detail Pembelian</th>
                <th>Nama Supplier</th>
                <th>Jumlah</th>
                <th>Nama Produk</th>
                <th>Harga Beli</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Laporan Stok Produk -->

  <!-- Judul -->
  <section class="Judul">
    <p>Laporan Stok Produk <br> (Inventory Stocks Report)</p>
  </section>

  <!-- Filter Bar -->
  <section class="filter_bar">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="sort3">
        <select class="form-select" id="bulanFilterPembelian" style="width: auto;" disabled>
          <option value="">Pilih Bulan</option>
          <option value="">All</option>
          <option value="1">Januari</option>
          <option value="2">Februari</option>
          <option value="3">Maret</option>
          <option value="4">April</option>
          <option value="5">Mei</option>
          <option value="6">Juni</option>
          <option value="7">Juli</option>
          <option value="8">Agustus</option>
          <option value="9">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
      </div>
      <div class="tombol_modif">
        <button class="tombol3 btn btn-dark" disabled><span>Delete All</span><i class="fa-solid fa-trash"></i></button>
        <button class="tombol4 btn btn-dark" disabled><span>Add Data</span><i
            class="fa-solid fa-square-plus"></i></button>
      </div>
    </div>
  </section>

  <!-- Tabel Stok -->
  <section class="tabel3">
    <table class="table table-bordered align-middle" id="datatableid3">
      <thead>
        <tr class="kolom">
          <th style="border-top-left-radius: 10px; border-bottom-left-radius: 10px; width: 15%">ID Produk</th>
          <th style="width: 25%">Nama Produk</th>
          <th style="width: 20%">Jumlah Stok</th>
          <th style="border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-right: none; width: 20%">
            Detail</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr class="kolom_total3">
          <td style="text-align: center;">
            <h5>Total</h5>
          </td>
          <td style="text-align: center;">
            <h5>0</h5>
          </td>
          <td style="text-align: right;">
            <h5>0</h5>
          </td>
          <td></td>
        </tr>
    </table>
  </section>

  <!-- Modal Detail Stok -->
  <div class="modal fade" id="detailModal3" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detail Jumlah Stok</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <p><strong>ID Produk: </strong> <span id="detailIDP3"></span></p>
          <p><strong>Nama Produk: </strong> <span id="detailProduk3"></span></p>
          <p><strong>ID Supplier: </strong> <span id="detailID3"></span></p>
          <p><strong>Nama Supplier: </strong> <span id="detailSupplier3"></span></p>
          <p><strong>Jumlah Stok: </strong> <span id="detailTotal3"></span></p>
          <p><strong>Harga Jual: </strong> <span id="detailJual3"></span></p>
          <p><strong>Harga Beli: </strong> <span id="detailBeli3"></span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.bootstrap5.min.js"></script>

  <script>

    let dataTable = $('#datatableid1').DataTable();
    let dataTable2 = $('#datatableid2').DataTable();
    let dataTable3 = $('#datatableid3').DataTable();

    let seluruhPenjualan = 0;
    let seluruhPembelian = 0;
    let bulananPenjualan = 0;
    let bulananPembelian = 0;

    // Mekanisme Log Out
    document.getElementById("logoutBtn").addEventListener("click", function (e) {
      e.preventDefault();
      const confirmLogout = confirm("Apakah Anda yakin ingin logout?");
      if (confirmLogout) {
        window.location.href = "logout.php?message=logout";
      }
    });

    window.addEventListener('pageshow', function (event) {
      if (event.persisted) {
        window.location.reload();
      }
    });


    // Load Laporan Penjualan

    $('#bulanFilterPenjualan').on('change', function () {
      const bulanPenjualan = $(this).val();
      const bulanPembelian = $('#bulanFilterPembelian').val();
      $('#bulanFilterPembelian').val(bulanPenjualan);
      loadLaporan(bulanPenjualan);
      loadLaporan2(bulanPenjualan);
    });

    $('#datatableid1 tbody').on('click', 'a.detail', function (e) {
      e.preventDefault();
      const idPenjualan = $(this).data('id');
      console.log('ID Penjualan:', idPenjualan);
      loadDetailPenjualan(idPenjualan);
    });

    // Fungsi loadLaporan dengan parameter bulan
    function loadLaporan(bulan = "") {
      bulananPenjualan = 0;
      const url = bulan ? `laporan.php?month=${bulan}` : 'laporan.php';

      fetch(url)
        .then(res => res.json())
        .then(data => {
          console.log("Data Diterima:", data);
          dataTable.clear();

          let totalPenjualan = 0;
          let totalProduk = 0;

          data.forEach(dp => {
            dataTable.row.add([
              dp.Tanggal,
              dp.ID,
              'Rp ' + parseFloat(dp.Total).toLocaleString('id-ID'),
              parseInt(dp.Jumlah).toLocaleString('id-ID'),
              `<a class="detail icon-link" href="#" style="color: #000000; text-decoration: none;" data-id="${dp.ID}"><i class="fa-solid fa-magnifying-glass"></i></a>`
            ]);
            totalPenjualan += parseFloat(dp.Total);
            totalProduk += parseInt(dp.Jumlah);
            bulananPenjualan += parseFloat(dp.Total);
          });
          dataTable.draw();

          document.querySelector('.kolom_total td:nth-child(2) h5').innerText = 'Rp ' + totalPenjualan.toLocaleString('id-ID');
          document.querySelector('.kolom_total td:nth-child(3) h5').innerText = totalProduk;

          document.getElementById('totalSales2').innerText = 'Rp ' + totalPenjualan.toLocaleString('id-ID');
          updateLaba();
        })
        .catch(error => {
          console.error('Gagal load penjualan:', error);
          alert('Gagal memuat data penjualan.');
        });
    }


    // Load Detail untuk Laporan Penjualan
    function loadDetailPenjualan(id) {
      fetch(`laporan_detail_penjualan.php?id=${id}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('detailTanggal').innerText = data.Tanggal;
          document.getElementById('detailID').innerText = data.ID;
          document.getElementById('detailTotal').innerText = 'Rp ' + parseFloat(data.Total).toLocaleString('id-ID');

          const tbody = document.querySelector('#detailDetail tbody');
          tbody.innerHTML = '';

          data.Detail.forEach(dp => {
            tbody.innerHTML += `
          <tr>
            <td>${dp.IDP}</td>
            <td>${dp.Jumlah}</td>
            <td>${dp.Produk}</td>
            <td>Rp ${parseFloat(dp.Harga).toLocaleString('id-ID')}</td>
            <td>Rp ${parseFloat(dp.Subtotal).toLocaleString('id-ID')}</td>
          </tr>`;
          });

          $('#detailModal').modal('show');
        })
        .catch(err => {
          console.error('Gagal ambil detail: penjualan', err);
          alert('Gagal memuat detail penjualan');
        });
    }



    // Laporan Pembelian

    $('#bulanFilterPembelian').on('change', function () {
      const bulanPembelian = $(this).val();
      const bulanPenjualan = $('#bulanFilterPenjualan').val();
      $('#bulanFilterPenjualan').val(bulanPembelian);
      loadLaporan(bulanPembelian);
      loadLaporan2(bulanPembelian);
    });


    $('#datatableid2 tbody').on('click', 'a.detail', function (e) {
      e.preventDefault();
      const idPembelian = $(this).data('id');
      console.log('Detail untuk pembelian:', idPembelian);
      loadDetailPembelian(idPembelian);
    });

    // Fungsi loadLaporan dengan parameter bulan
    function loadLaporan2(bulan = "") {
      bulananPembelian = 0;
      const url = bulan ? `laporan2.php?month=${bulan}` : 'laporan2.php';

      fetch(url)
        .then(res => res.json())
        .then(data => {
          console.log("Data Diterima:", data);
          dataTable2.clear();

          let totalPembelian = 0;
          let totalProduk2 = 0;

          data.forEach(dp => {
            dataTable2.row.add([
              dp.Tanggal2,
              dp.ID2,
              'Rp ' + parseFloat(dp.Total2).toLocaleString('id-ID'),
              parseInt(dp.Jumlah2).toLocaleString('id-ID'),
              `<a class="detail icon-link" href="#" style="color: #000000; text-decoration: none;" data-id="${dp.ID2}"><i class="fa-solid fa-magnifying-glass"></i></a>`
            ]);
            totalPembelian += parseFloat(dp.Total2);
            totalProduk2 += parseInt(dp.Jumlah2);
            bulananPembelian += parseFloat(dp.Total2);
          });
          dataTable2.draw();

          document.querySelector('.kolom_total2 td:nth-child(2) h5').innerText = 'Rp ' + totalPembelian.toLocaleString('id-ID');
          document.querySelector('.kolom_total2 td:nth-child(3) h5').innerText = totalProduk2;

          document.getElementById('totalBuy2').innerText = 'Rp ' + totalPembelian.toLocaleString('id-ID');
          updateLaba();
        })
        .catch(error => {
          console.error('Gagal load pembelian:', error);
          alert('Gagal memuat data pembelian.');
        });
    }

    // Load data detail pembelian
    function loadDetailPembelian(id) {
      fetch(`laporan_detail_pembelian.php?id=${id}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('detailTanggal2').innerText = data.Tanggal2;
          document.getElementById('detailTotal2').innerText = 'Rp ' + parseFloat(data.Total2).toLocaleString('id-ID');

          const tbody = document.querySelector('#detailDetail2 tbody');
          tbody.innerHTML = '';

          data.Detail2.forEach(dp => {
            tbody.innerHTML += `
          <tr>
            <td>${dp.ID2}</td>
            <td>${dp.IDP2}</td>
            <td>${dp.Supplier2}</td>
            <td>${dp.Jumlah2}</td>
            <td>${dp.Produk2}</td>
            <td>Rp ${parseFloat(dp.Harga2).toLocaleString('id-ID')}</td>
            <td>Rp ${parseFloat(dp.Subtotal2).toLocaleString('id-ID')}</td>
          </tr>`;
          });

          $('#detailModal2').modal('show');
        })
        .catch(err => {
          console.error('Gagal ambil detail pembelian:', err);
          alert('Gagal memuat detail pembelian');
        });
    }



    // Laporan Stok

    $('#datatableid3 tbody').on('click', 'a.detail', function (e) {
      e.preventDefault();
      const idStok = $(this).data('id');
      console.log('ID Stok:', idStok);
      loadDetailStok(idStok);
    });

    // Fungsi loadLaporan dengan parameter bulan
    function loadLaporan3() {
      fetch('laporan3.php')
        .then(res => res.json())
        .then(data => {
          console.log("Data Diterima:", data);
          dataTable3.clear();

          let totalStok = 0;
          const jenisProduk = new Set();

          data.forEach(s => {
            jenisProduk.add(s.Produk3);
            dataTable3.row.add([
              s.ID3,
              s.Produk3,
              parseInt(s.Jumlah3).toLocaleString('id-ID'),
              `<a class="detail icon-link" href="#" style="color: #000000; text-decoration: none;" data-id="${s.ID3}"><i class="fa-solid fa-magnifying-glass"></i></a>`
            ]);
            totalStok += parseFloat(s.Jumlah3);
          });
          dataTable3.draw();

          const jumlahProduk = jenisProduk.size;

          document.querySelector('.kolom_total3 td:nth-child(2) h5').innerText = jumlahProduk.toLocaleString('id-ID') + ' Jenis';
          document.querySelector('.kolom_total3 td:nth-child(3) h5').innerText = totalStok;

          document.getElementById('totalStok').innerText = totalStok;
          document.getElementById('totalStok2').innerText = jumlahProduk;
        })
        .catch(error => {
          console.error('Gagal load stok:', error);
          alert('Gagal memuat data stok.');
        });
    }

    function loadDetailStok(id) {
      fetch(`laporan_detail_stok.php?id=${id}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('detailIDP3').innerText = data.IDP3;
          document.getElementById('detailProduk3').innerText = data.Produk3;
          document.getElementById('detailID3').innerText = data.ID3;
          document.getElementById('detailSupplier3').innerText = data.Supplier3;
          document.getElementById('detailTotal3').innerText = parseFloat(data.Total3).toLocaleString('id-ID');
          document.getElementById('detailJual3').innerText = 'Rp ' + parseFloat(data.Jual3).toLocaleString('id-ID');
          document.getElementById('detailBeli3').innerText = 'Rp ' + parseFloat(data.Beli3).toLocaleString('id-ID');

          $('#detailModal3').modal('show');
        })
        .catch(err => {
          console.error('Gagal ambil stok produk:', err);
          alert('Gagal memuat stok produk');
        });
    }


    // Fungsi untuk Kartu


    // Load Total Penjualan di Kartu
    function loadTotalSales() {
      fetch('laporan_all_penjualan.php')
        .then(res => res.json())
        .then(data => {
          const totalPenjualan = parseFloat(data.total_penjualan) || 0;
          seluruhPenjualan = parseFloat(data.total_penjualan) || 0;
          document.getElementById('totalSales').innerText = 'Rp ' + totalPenjualan.toLocaleString('id-ID');
          updateLaba();
        })
        .catch(error => {
          console.error('Gagal memuat total sales:', error);
          alert('Gagal memuat total sales.');
        });
    }

    // Load Total Pembelian di Kartu
    function loadTotalBuy() {
      fetch('laporan_all_pembelian.php')
        .then(res => res.json())
        .then(data => {
          const totalPembelian = parseFloat(data.total_pembelian) || 0;
          seluruhPembelian = parseFloat(data.total_pembelian) || 0;
          document.getElementById('totalBuy').innerText = 'Rp ' + totalPembelian.toLocaleString('id-ID');
          updateLaba();
        })
        .catch(error => {
          console.error('Gagal memuat total buy/purchases:', error);
          alert('Gagal memuat total buy/pruchases.');
        });
    }


    // Fungsi untuk update laba
    function updateLaba() {
      const labaKotor = seluruhPenjualan - seluruhPembelian;
      const labaBersih = labaKotor - 3600000;

      const labaKotorBulan = bulananPenjualan - bulananPembelian;
      const labaBersihBulan = labaKotorBulan - 300000;

      document.getElementById('grossProfit').innerText = 'Rp ' + labaKotor.toLocaleString('id-ID');
      document.getElementById('netProfit').innerText = 'Rp ' + labaBersih.toLocaleString('id-ID');
      document.getElementById('grossProfit2').innerText = 'Rp ' + labaKotorBulan.toLocaleString('id-ID');
      document.getElementById('netProfit2').innerText = 'Rp ' + labaBersihBulan.toLocaleString('id-ID');
    }

    loadLaporan();
    loadLaporan2();
    loadLaporan3();
    loadTotalSales();
    loadTotalBuy();


  </script>
</body>

</html>