<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Esteban&family=Noto+Sans:wght@400;800&display=swap"
    rel="stylesheet" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

  <!-- DataTables Bootstrap 5 CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.0/css/dataTables.bootstrap5.min.css" />

  <style>
    .nav_website {
      background-color: black;
      padding: 2%;
      margin-bottom: 5vh;
    }

    .nav_website a {
      font-family: 'Inter';
      font-weight: 600;
      font-size: 18px;
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
    }

    .nav_website a:hover {
      background-color: white;
      color: black;
      transition: 0.3s;
    }

    .Judul {
      padding: 4%;
      font-family: 'Inter';
      font-weight: 600;
      font-size: 20px;
    }

    .kartu {
      margin: 5% 0 0 5%;
      background-color: #F5F5F5;
      height: 20vh;
      border-radius: 10px;
    }

    .headerkartu {
      text-align: left;
      padding: 5% 0 0 5%;
      font-size: 14px;
      font-weight: 600;
    }

    .row {
      margin-bottom: 20px;
    }

    .isi {
      padding-top: 15%;
    }

    .filter_bar {
      position: relative;
    }

    .sort1 {
      padding-left: 4%;
      opacity: 0;
    }

    .sort2 {
      padding-left: 4%;
      opacity: 0;
    }

    .sort3 {
      padding-left: 4%;
      opacity: 0;
    }

    .tombol_modif {
      position: absolute;
      right: 4%;
      top: 0;
      display: flex;
      gap: 10px;
      align-items: center;
      opacity: 0;
    }

    .tombol1 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #db1515;
      cursor: alias;
    }

    .tombol2 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #000000;
      cursor: alias;
    }

    .tombol3 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #db1515;
      cursor: alias;
    }

    .tombol4 {
      display: flex;
      align-items: center;
      gap: 8px;
      background-color: #000000;
      cursor: alias;
    }

    .tabel1 {
      padding: 0 4%;
      margin-bottom: 20vh;
    }

    .tabel2 {
      padding: 0 4%;
      margin-bottom: 20vh;
    }

    .tabel3 {
      padding: 0 4%;
      margin-bottom: 20vh;
    }

    .table th {
      text-align: center;
    }

    .kolom th {
      background-color: #D9D9D9;
      border-right: 1px solid black;
      text-align: center;
    }

    tbody {
      text-align: center;
    }

    .kolom_total h5 {
      text-align: center;
    }

    table.dataTable thead th {
      background-color: #D9D9D9 !important;
      color: black;
      vertical-align: middle;
    }

    table.dataTable thead th.sorting::after,
    table.dataTable thead th.sorting_asc::after,
    table.dataTable thead th.sorting_desc::after {
      color: black !important;
      opacity: 1 !important;
    }

    table.dataTable thead th.sorting::after {
      content: "\f0dc";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    table.dataTable thead th.sorting_asc::after {
      content: "\f0de";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    table.dataTable thead th.sorting_desc::after {
      content: "\f0dd";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }
  </style>
</head>

<body>

  <!-- Modifikasi Produk -->

  <!-- Navigation -->
  <nav class="nav_website">
    <ul class="nav nav-pills nav-fill">
      <li class="nav-item"><a class="nav-link" href="proteksiDashboard.php">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="proteksiMP.php">Manajemen Produk</a></li>
      <li class="nav-item"><a class="nav-link" href="proteksiMT.php">Manajemen Transaksi</a></li>
      <li class="nav-item"><a class="nav-link" href="proteksiLaporan.php">Laporan</a></li>
      <li class="nav-item"><a class="nav-link" href="#" id="logoutBtn">Log Out</a></li>
    </ul>
  </nav>

  <!-- Judul -->
  <section class="Judul">
    <p>Ringkasan <br> (Summary)</p>
  </section>

  <!--Summary -->
  <div class="container text-center">
    <div class="row">
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Penjualan</div>
          <div class="bodykartu">
            <h5 id="totalSales" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Total Pembelian</div>
          <div class="bodykartu">
            <h5 id="totalBuy" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Laba Kotor</div>
          <div class="bodykartu">
            <h5 id="grossProfit" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="kartu" style="max-width: 18rem;">
          <div class="headerkartu">Laba Bersih</div>
          <div class="bodykartu">
            <h5 id="netProfit" class="isi card-title">0</h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <article style="padding: 4% 0 4% 4%;">
    <p>Keterangan:<br>
      1. COGS + Miscellaneous Expenditures untuk keseluruhan/tahunannya adalah Rp3.600.000
    </p>
  </article>

  <!-- Judul -->
  <section class="Judul">
    <p>Manajemen Produk <br> (Product Management)</p>
  </section>

  <!-- Filter Bar -->
  <section class="filter_bar">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="sort1">
        <select class="form-select" id="bulanFilterPenjualan" style="width: auto;">
          <option value="">Pilih Bulan</option>
          <option value="">All</option>
          <option value="1">Januari</option>
          <option value="2">Februari</option>
          <option value="3">Maret</option>
          <option value="4">April</option>
          <option value="5">Mei</option>
          <option value="6">Juni</option>
          <option value="7">Juli</option>
          <option value="8">Agustus</option>
          <option value="9">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
      </div>
      <div class="tombol_modif">
        <button class="tombol1 btn btn-dark" disabled><span>Delete All</span><i class="fa-solid fa-trash"></i></button>
        <button class="tombol2 btn btn-dark" disabled><span>Add Data</span><i
            class="fa-solid fa-square-plus"></i></button>
      </div>
    </div>
  </section>

  <!-- Tabel Produk -->
  <section class="tabel1">
    <table class="table table-bordered align-middle" id="datatableid1">
      <thead>
        <tr class="kolom">
          <th style="border-top-left-radius: 10px; border-bottom-left-radius: 10px;">Nama Produk</th>
          <th style="width: 10%;">ID Produk</th>
          <th>Kategori</th>
          <th style="width: 20%;">Supplier</th>
          <th style="width: 5%;">Stock</th>
          <th style="width: 5%;">Satuan</th>
          <th>Harga Jual</th>
          <th>Harga Beli</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>


  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/2.3.0/js/dataTables.bootstrap5.min.js"></script>

  <script>



    let dataTable = $('#datatableid1').DataTable({ order: [[1, 'asc']] });
    let seluruhPembelian = 0;
    let seluruhPenjualan = 0;

    // Mekanisme Log Out
    document.getElementById("logoutBtn").addEventListener("click", function (e) {
      e.preventDefault();
      const confirmLogout = confirm("Apakah Anda yakin ingin logout?");
      if (confirmLogout) {
        window.location.href = "logout.php?message=logout";
      }
    });

    window.addEventListener('pageshow', function (event) {
      if (event.persisted) {
        window.location.reload();
      }
    });


    // Load Manajemen Produk

    $(document).ready(function () {

      function loadProduk() {
        fetch('dashboard.php')
          .then(res => res.json())
          .then(data => {
            dataTable.clear().draw();
            data.forEach(product => {
              dataTable.row.add([
                product.Nama_Produk,
                product.ID,
                product.Kategori,
                product.Supplier,
                product.Stock,
                'Unit',
                'Rp ' + parseFloat(product.Harga).toLocaleString('id-ID'),
                'Rp ' + parseFloat(product.Harga2).toLocaleString('id-ID')
              ]);
            });
            dataTable.draw();
          })
          .catch(error => {
            console.error('Gagal load produk:', error);
            alert('Gagal memuat data produk.');
          });
      }
      loadProduk();
      loadTotalSales();
      loadTotalBuy();
    })


    // Load Total Penjualan di Kartu
    function loadTotalSales() {
      fetch('laporan_all_penjualan.php')
        .then(res => res.json())
        .then(data => {
          const totalPenjualan = parseFloat(data.total_penjualan) || 0;
          seluruhPenjualan = totalPenjualan;
          document.getElementById('totalSales').innerText = 'Rp ' + totalPenjualan.toLocaleString('id-ID');
          updateLaba();
        })
        .catch(error => {
          console.error('Gagal memuat total sales:', error);
          alert('Gagal memuat total sales.');
        });
    }

    // Load Total Pembelian di Kartu
    function loadTotalBuy() {
      fetch('laporan_all_pembelian.php')
        .then(res => res.json())
        .then(data => {
          const totalPembelian = parseFloat(data.total_pembelian) || 0;
          seluruhPembelian = totalPembelian;
          document.getElementById('totalBuy').innerText = 'Rp ' + totalPembelian.toLocaleString('id-ID');
          updateLaba();
        })
        .catch(error => {
          console.error('Gagal memuat total buy/purchases:', error);
          alert('Gagal memuat total buy/pruchases.');
        });
    }


    // Fungsi untuk update laba
    function updateLaba() {
      const labaKotor = seluruhPenjualan - seluruhPembelian;
      const labaBersih = labaKotor - 3600000;

      document.getElementById('grossProfit').innerText = 'Rp ' + labaKotor.toLocaleString('id-ID');
      document.getElementById('netProfit').innerText = 'Rp ' + labaBersih.toLocaleString('id-ID');
    }

  </script>
</body>

</html>